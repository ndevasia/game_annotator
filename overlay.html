<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>Note Annotation</title>
  <style>
    body {
      margin: 0;
      background-color: rgba(0, 0, 0, 0); /* Semi-transparent dark overlay */
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      color: white;
      font-family: sans-serif;
    }
    #annotation-ui {
      width: 90%;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    textarea {
      width: 100%;
      height: 100px;
      font-size: 16px;
      padding: 10px;
      border: none;
      border-radius: 5px;
      resize: none;
      background-color: rgba(255, 255, 255, 0.9);
      color: #000;
    }
    button {
      margin-top: 10px;
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      background-color: #4CAF50;
      color: white;
    }
  </style>
</head>
<body>
  <div id="annotation-ui">
    <textarea id="note" placeholder="Type your annotation..."></textarea>
    <button onclick="saveNote()">Save</button>
  </div>

  <script>
    const { ipcRenderer } = require('electron');

    function saveNote() {
      const note = document.getElementById('note').value;
      const timestamp = Date.now();
      ipcRenderer.send('save-annotation', { note, timestamp });
      document.getElementById('note').value = '';
      ipcRenderer.send('hide-overlay');
    }

    ipcRenderer.on('emoji-reaction', (event, emoji) => {
      // Hide annotation UI
      const annotationUI = document.getElementById('annotation-ui');
      if (annotationUI) annotationUI.style.display = 'none';

      // Show emoji reaction on overlay
      showEmojiReaction(emoji);
    });
    ipcRenderer.on('show-annotation-ui', () => {
      const annotationUI = document.getElementById('annotation-ui');
      if (annotationUI) annotationUI.style.display = 'flex';
    });


    function showEmojiReaction(emoji) {
      const emojiDiv = document.createElement('div');
      emojiDiv.textContent = emoji;
      emojiDiv.style.position = 'fixed';
      emojiDiv.style.top = '20%';
      emojiDiv.style.left = '50%';
      emojiDiv.style.transform = 'translateX(-50%)';
      emojiDiv.style.fontSize = '5rem';
      emojiDiv.style.opacity = '1';
      emojiDiv.style.transition = 'opacity 1.5s ease-out';
      emojiDiv.style.pointerEvents = 'none';     // Prevent interaction
      emojiDiv.style.background = 'none';        // No background color
      emojiDiv.style.willChange = 'opacity';     // Optimize opacity transition
      emojiDiv.style.userSelect = 'none';        // Prevent text selection

      document.body.appendChild(emojiDiv);

      setTimeout(() => {
        emojiDiv.style.opacity = '0';
      }, 500);

      setTimeout(() => {
        if (emojiDiv.parentNode) {
          emojiDiv.parentNode.removeChild(emojiDiv);
        }
      }, 2000);
    }

  </script>
</body>
</html>
