<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Video + Annotations</title>
  <style>
    video { width: 100%; max-width: 700px; margin-bottom: 1em; }
    .annotation { margin: 5px 0; padding: 4px 8px; border-left: 4px solid #ccc; }
  </style>
</head>
<body>
  <h1>Video Session with Annotations</h1>
  <video id="videoPlayer" controls>
    <source src="Videos/session1.mp4" type="video/mp4">
    Your browser does not support the video tag.
  </video>

  <div id="annotations"></div>

  <script>
  const fs = require('fs');
  const path = require('path');

  const annotationsDir = path.join(__dirname, 'annotations');
  const videosDir = path.join(__dirname, 'videos'); // Update to your actual video folder if different

  function getLatestFile(dir, ext) {
    const files = fs.readdirSync(dir)
      .filter(f => f.endsWith(ext))
      .sort()
      .reverse(); // newest first

    return files.length > 0 ? files[0] : null;
  }

  const latestAnnotation = getLatestFile(annotationsDir, '.json');
  const latestVideo = getLatestFile(videosDir, '.mkv'); // or '.mp4', depending on what OBS saves

  if (!latestAnnotation || !latestVideo) {
    console.error('Missing latest annotation or video file.');
  } else {
    const annotationPath = path.join(annotationsDir, latestAnnotation);
    const videoPath = path.join(videosDir, latestVideo);

    // Load video
    const video = document.getElementById('videoPlayer');
    video.src = `videos/${latestVideo}`; // relative path for use in <video> tag

    // Load annotations
    fs.readFile(annotationPath, 'utf8', (err, data) => {
      if (err) {
        console.error('Failed to load annotations:', err);
        return;
      }

      const annotations = JSON.parse(data);
      const container = document.getElementById('annotations');

      annotations.forEach(a => {
        const note = document.createElement('div');
        note.className = 'annotation';
        const relTime = new Date(a.timestamp).toLocaleTimeString();
        note.innerHTML = `<strong>${relTime}</strong>: ${a.note}`;
        note.onclick = () => {
          // TODO: Convert timestamp to video time for seeking
          console.log(`Annotation clicked: ${a.note}`);
        };
        container.appendChild(note);
      });
    });
  }
</script>

</body>
</html>
